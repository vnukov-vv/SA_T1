# Задание №7
> Постановка задачи на разработку

Взять любой спроектированный метод из ДЗ №3 (не GET, не DELETE)
Описать бизнес – задачу на разработку с проектированием нового метода API (по шаблону)

<sup>*</sup> *вставить диаграмму последовательности и SQL-скрипт*

-----
<details><summary> <i> см. выбранный метод в OpenAPI (Swagger) (развернуть)</i> </summary>

```swagger
openapi: 3.0.0
info:
  title: Bank API
  description: метод API для открытия банковского счета клиенту
  version: 1.0.0
  contact:
    name: Bank API Support
    url: https://www.bank.com/support
    email: support@bank.com
servers:
  - url: https://webinarOpenSchool.org/api/v1
tags:
  - name: Счета

# Методы

## Счета
paths:  

  /accounts:
     post:
      deprecated: false
      tags:
        - Счета
      summary: Создать банковский счет
      description: Открытие в АБС Банка счета Клиенту (юридическому, физическому лицу или индивидуальному предпринимателю), заведенному в Систему.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                clientId:
                  type: string
                  description: Уникальный идентификатор клиента
                  example: "0001010"
      # Клиента не расписываем т.к. для юрлица и физлица разные атрибуты, остальные параметры транзитивно связаны, поэтому достаточно указать клиента, балансовый счет второго порядка и валюту.
                bals:
                  type: string
                  description: Балансовый счет
                  example: "40817"
                currency:
                  type: string
                  description: Балансовый счет
                  example: "RUB"
                accountName:
                  type: string
                  description: Наименование счета
                  example: "не заполнено"
      responses:
        '201':
          description: Создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          description: Некорректный запрос
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '409':
          description: Конфликт
        '422':
          description: Проверьте введенные данные
        '500':
          description: Сервер недоступен
          
# Схемы

components:
  schemas:
    Account:
      type: object
      description: Данные счета
      properties:
        accountId:
          type: string
          description: Уникальный идентификатор счета
          example: "00000001234"
        accountName:
        # потому что счета могут быть внутрибанковскими (доходы, расходы и т.д.)
          type: string
          description: Наименование счета
          example: "не заполнено"
        clientId:
          type: string
          description: Уникальный идентификатор клиента
          example: "0001010"
        clientName:
          type: string
          description: Уникальный идентификатор клиента
          example: "Иванов Петр Сидорович"
          # Прочие атрибуты Клиента не расписываем
          # т.к. для юрлица и физлица они разные
        bals:
          type: string
          description: Балансовый счет
          example: "40817"
        currency:
          type: string
          description: Балансовый счет
          example: "RUB"
        accountNumber:
          type: string
          description: Номер счета
          example: "40817810300000000003"
        accountType:
          type: string
          description: Тип счета
          example: "П"
          enum:
           - А
           - П
        status:
          type: string
          description: Статус счета 
          example: "ACTIVE"
          enum:
            - ACTIVE
            - CLOSED
            - RESERVED
            - DELETED
        balance:
          type: number
          format: money
          description: Текущий баланс счета
          example: 0.01
        timeStamp:
          description: Дата модификации
          type: string
          format: date-time
      required:
        - clientId
        - bals
        - currency
```
</details>

<table width="1000" border="1">
<thead>
  <tr>
    <td rowspan="3"><img width="300px" src="https://github.com/user-attachments/assets/9d985eaa-c3fc-4ab3-b84c-4acbd7c1bbb2"></td>
    <td colspan="2" width="700"><p align="center"><b> API. Открытие счета в АБС Банка </b></p></td>
  </tr>
  <tr>
    <td>Дата</td>
    <td>25.08.2024</td>
  </tr>
  <tr>
    <td>Версия</td>
    <td>1.0</td>
  </tr>
</thead>
</table>

<details><summary> <i> см. Шаблон (развернуть)</i> </summary>

# Я как клиент банка хочу увидеть информацию о счете

## История версий
|Задача|Тип изменения|Цвет изменения|Дата|Автор|
|-|-|-|-|-|
|Ссылка на задачу|Создано|-|01.08.2024|Герасимова Е|
|Ссылка на задачу|Изменено (указать раздел и пункт)|синий|10.08.2024|Герасимова Е|

## Бизнес-анализ
[Ссылка на бизнес-анализ](#)

## Назначение и цель
Отображение клиенту информации по запрашиваемому счету

## Предварительные действия
- Реализована модель данных в СУБД
- Пользователь прошел аутентификацию и авторизацию

## Ограничения по ролям
- Доступ к интерфейсу возможен для авторизованного клиента с ролью `CLIENT_ALL`

## Макеты
[Ссылка на Figma/Pixco/draw.io](#)

## Основной сценарий (успешный сценарий)

1. Пользователь переходит на страницу `https://....` в свой личный кабинет.
2. Front делает запрос на Back `GET /accounts` ([ссылка на API](#)).
   - Если Back вернул ошибки 4xx, 5xx см. альтернативный сценарий 1.
3. Front отображает список счетов в соответствии с п. [Макеты](#макеты).
4. Пользователь выбирает любой из счетов.
5. Front делает запрос на Back `GET /accounts/{accountId}` ([ссылка на API](#)).
   - Если Back вернул ошибки 4xx, 5xx см. альтернативный сценарий 1.
6. Front отображает детальную информацию по счету в соответствии с п. [Макеты](#макеты).

## Альтернативный сценарий
1. Front отображает ошибку от Back.

## Требования к интерфейсу

|Название<br>атрибута|Тип|Длина|Редактируемость|Маска<br>ввода/отображения|Обязательность|Сортировка|Значение<br>по умолчанию| Источник<br>данных|Примечания|
|-|-|-|-|-|-|-|-|-|-|
|Номер счета|Label|20|-|-|+|-|-|Back|Пример: 40781000208102500000|
|Текущий баланс счета|Label|15,2|-|-|+|-|0.00 Р|Back|-|
|Статус счета|Label|20|-|-|+|-|-|Back|ACTIVE - Активен<br>CLOSED - Закрыт<br>RESERVED - Зарезервирован|

## Результат

- Клиент в ЛК видит информацию о конкретном счете.

---

# `GET /accounts/{accountId}` Получить информацию о банковском счете

## История версий
|Задача|Тип изменения|Цвет изменения|Дата|Автор|
|-|-|-|-|-|
|Ссылка на задачу|Создано|-|10.06.2024|Герасимова Е|

## Сервис 
**Микросервис:** account-number

### Алгоритм вызова
- Sequence UML (вставить картинку)

Акторы:
- Пользователь
- Фронт
- Бек
- БД
- + Альтернативные сценарии

### Свойства вызова

| Свойство               | Описание                      |
|------------------------|-------------------------------|
| Тип взаимодействия      | REST/Kafka/Артемис MQ/gRPC/GraphQL |
| Формат запроса/ответа   | JSON/XML                      |
| Тип вызова              | Синхронный/Асинхронный        |
| Протокол взаимодействия | HTTPS/MTLS                   |
| Способ аутентификации   | Bearer Token/ API key/ JWT   |

### Формат запроса

|Параметр|Тип|Длина|Расположение<br>(path/query)|Обязательность|Описание|
|-|-|-|-|-|-|
|accountId|string|-|path|+|Уникальный идентификатор счета|

#### Пример
*GET /accounts/40781000287777000002*

### Тело запроса
| Параметр | Тип | Длина | Расположение (body) | Обязательность | Описание | Место для сохранения |
|----------|-----|-------|---------------------|----------------|----------|----------------------|
| -        | -   | -     | -                   | -              | -        | Таблица.поле         |

#### Пример

### Формат ответа

| Параметр      | Тип           | Длина | Обязательность | Описание                      | Источник данных   | Отображение на фронте      |
|---------------|---------------|-------|----------------|--------------------------------|-------------------|----------------------------|
| accountId     | integer       | 20    | +              | Уникальный идентификатор счета | account_info.id   | -                          |
| accountNumber | string        | 20    | +              | Номер счета                    | account_info.number | Номер счета                |
| balance       | number($double) | 15,2  | +              | Текущий баланс счета           | account_info.balance | Баланс счета              |
| status        | string        | 20    | +              | Статус счета                   | account_info.status | Статус                      |
| Enum: [ACTIVE, CLOSED, RESERVED] |  |       |                |                                |                   |                            |
#### Пример

```json
{
  "accountId": 70203333,
  "accountNumber": "40781000208102500000",
  "balance": 471230.77,
  "status": "ACTIVE"
}
```
## Коды ответов

|Код|Название|Описание|Поведение системы|
|-|-|-|-|
|200|OK|Запрос обработан|Продолжить процесс|
|400|Bad Request| Некорректный счет|Отобразить ошибку|
|403|Forbidden| Доступ запрещен|Отобразить ошибку|
|404|Not Found| Счет не найден|Отобразить ошибку|
|500|Internal Server Error|Внутренняя ошибка сервера|Отобразить ошибку|

## Алгоритм обработки запроса

1. **Back** при получении запроса, обращается в таблицу `user`, находит список счетов и проводит валидацию на совпадение.
   - (Приложить пример SQL запроса)
2. **Back** по запрошенному счету, обращается в таблицу `account_info` и отдает ответ на **Front** в соответствии с п. [Формат ответа](#формат-ответа).

## Альтернативные процессы

- Ошибки 4xx, 5xx:
  - **Back** возвращает ошибку с текстом на **Front** в соответствии с п. [Коды ответов](#коды-ответов).
</details>
